@model SchoolPortal.API.DTOs.Subject.CreateSubjectRequest

@{
    ViewData["Title"] = "Create Subject";
}

<h2>Create Subject</h2>

<div class="row">
    <div class="col-md-6">
        <form asp-action="Create">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            
            <div class="form-group">
                <label asp-for="SubjectName" class="control-label"></label>
                <input asp-for="SubjectName" class="form-control" />
                <span asp-validation-for="SubjectName" class="text-danger"></span>
            </div>
            
            <div class="form-group">
                <label asp-for="CompanyId" class="control-label">Company</label>
                <select asp-for="CompanyId" class="form-control" asp-items="ViewBag.Companies">
                    <option value="">-- Select Company --</option>
                </select>
                <span asp-validation-for="CompanyId" class="text-danger"></span>
            </div>
            
            <div class="form-group">
                <label asp-for="SchoolId" class="control-label">School</label>
                <select asp-for="SchoolId" class="form-control" asp-items="ViewBag.Schools">
                    <option value="">-- Select School --</option>
                </select>
                <span asp-validation-for="SchoolId" class="text-danger"></span>
            </div>
            
            <div class="form-group form-check">
                <input type="checkbox" asp-for="IsScholastic" class="form-check-input" />
                <label asp-for="IsScholastic" class="form-check-label"></label>
            </div>
            
            <div class="form-group form-check">
                <input type="checkbox" asp-for="IsActive" class="form-check-input" checked />
                <label asp-for="IsActive" class="form-check-label"></label>
            </div>
            
            <div class="form-group">
                <label asp-for="Status" class="control-label"></label>
                <input asp-for="Status" class="form-control" value="Active" />
                <span asp-validation-for="Status" class="text-danger"></span>
            </div>
            
            <div class="form-group">
                <label asp-for="StatusMessage" class="control-label"></label>
                <textarea asp-for="StatusMessage" class="form-control" rows="3"></textarea>
                <span asp-validation-for="StatusMessage" class="text-danger"></span>
            </div>
            
            <input type="hidden" asp-for="CreatedBy" value="@User.FindFirst("sub")?.Value" />
            
            <div class="form-group">
                <button type="submit" class="btn btn-primary">Create</button>
                <a asp-action="Index" class="btn btn-secondary">Back to List</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        $(document).ready(function() {
            // Load schools based on selected company
            $('#CompanyId').change(function() {
                var companyId = $(this).val();
                var schoolDropdown = $('#SchoolId');
                
                schoolDropdown.empty();
                schoolDropdown.append($('<option>', {
                    value: '',
                    text: '-- Select School --'
                }));
                
                if (companyId) {
                    $.getJSON('/School/GetByCompany', { companyId: companyId }, function(schools) {
                        $.each(schools, function(i, school) {
                            schoolDropdown.append($('<option>', {
                                value: school.id,
                                text: school.name
                            }));
                        });
                    });
                }
            });
        });
    </script>
}